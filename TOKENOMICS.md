# üìä –¢–û–ö–ï–ù–û–ú–ò–ö–ê UX AUDIT PLATFORM

**–í–µ—Ä—Å–∏—è**: 2.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 01.12.2025
**–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–Ω–æ

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ–≤](#—Å—Ç–æ–∏–º–æ—Å—Ç—å-–∞—É–¥–∏—Ç–æ–≤)
3. [–ü–∞–∫–µ—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤](#–ø–∞–∫–µ—Ç—ã-–∫—Ä–µ–¥–∏—Ç–æ–≤)
4. [–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫](#—Å–∏—Å—Ç–µ–º–∞-–ø–æ–¥–ø–∏—Å–æ–∫)
5. [–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã](#–ø–ª–∞—Ç–µ–∂–Ω—ã–µ-—Å–∏—Å—Ç–µ–º—ã)
6. [–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ](#—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
7. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
8. [API Endpoints](#api-endpoints)
9. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

UX Audit Platform –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≥–∏–±—Ä–∏–¥–Ω—É—é –º–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏**:

- **–ú–æ–¥–µ–ª—å –∫—Ä–µ–¥–∏—Ç–æ–≤**: –ü–æ–∫—É–ø–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö –∞—É–¥–∏—Ç–æ–≤
- **–ú–æ–¥–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏**: –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π/–≥–æ–¥–æ–≤–æ–π –ø–ª–∞–Ω —Å –¥–Ω–µ–≤–Ω—ã–º –ª–∏–º–∏—Ç–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

‚úÖ **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –≤—Å–µ —Ü–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ `src/config/tokenomics.config.ts`
‚úÖ **–î–≤–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã** - Stripe (USD) –∏ LiqPay (UAH)
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –º–µ–∂–¥—É –∫—Ä–µ–¥–∏—Ç–∞–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–æ–π
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - —á–µ—Ç–∫–∏–µ —Ü–µ–Ω—ã –∏ –ª–∏–º–∏—Ç—ã

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ–≤

### –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö)

| –¢–∏–ø –∞—É–¥–∏—Ç–∞ | –ö—Ä–µ–¥–∏—Ç—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------|
| **Research** | 2 | –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π UX –∞–Ω–∞–ª–∏–∑ |
| **AB Test** | 1 | –ê–Ω–∞–ª–∏–∑ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| **Business** | 1 | –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| **Hypotheses** | 1 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∏–ø–æ—Ç–µ–∑ |
| **Survey** | 1 | –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –æ–ø—Ä–æ—Å–æ–≤ |
| **All Audits** | 4 | –í—Å–µ 4 —Ç–∏–ø–∞ –∞—É–¥–∏—Ç–æ–≤ –∑–∞ —Ä–∞–∑ (Research + AB + Business + Hypotheses) |

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 2.0

- ‚ú® **–ù–æ–≤—ã–π —Ç–∏–ø**: Survey (–æ–ø—Ä–æ—Å—ã) - 1 –∫—Ä–µ–¥–∏—Ç
- ‚ú® **–ù–æ–≤—ã–π —Ç–∏–ø**: All Audits (–∫–æ–º–±–æ) - 4 –∫—Ä–µ–¥–∏—Ç–∞
- üìâ **–°–Ω–∏–∂–µ–Ω–∞ —Ü–µ–Ω–∞**: AB Test (–±—ã–ª–æ 3, —Å—Ç–∞–ª–æ 1)
- üìâ **–°–Ω–∏–∂–µ–Ω–∞ —Ü–µ–Ω–∞**: Business (–±—ã–ª–æ 4, —Å—Ç–∞–ª–æ 1)

### –ì–¥–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å

–§–∞–π–ª: `src/config/tokenomics.config.ts`

```typescript
export const AUDIT_COSTS: Record<AuditType, AuditCostConfig> = {
  research: {
    credits: 2,  // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ –∑–¥–µ—Å—å
    // ...
  },
  // ...
}
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ –Ω—É–∂–Ω–æ **–æ–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**:

```sql
UPDATE audit_credits SET credits_cost = 2 WHERE audit_type = 'research';
```

---

## üéÅ –ü–∞–∫–µ—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

| –ü–∞–∫–µ—Ç | –ö—Ä–µ–¥–∏—Ç—ã | USD | UAH | –¶–µ–Ω–∞/–∫—Ä–µ–¥–∏—Ç | –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å |
|-------|---------|-----|-----|-------------|--------------|
| **Basic** | 10 | $1.99 | 80‚Ç¥ | $0.20 | - |
| **Pro** | 50 | $8.99 | 360‚Ç¥ | $0.18 | ‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–π |
| **Team** | 200 | $29.99 | 1200‚Ç¥ | $0.15 | - |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞–∫–µ—Ç–æ–≤

**Basic** (10 –∫—Ä–µ–¥–∏—Ç–æ–≤)
- ~5 Research –∞—É–¥–∏—Ç–æ–≤
- ~10 –±—ã—Å—Ç—Ä—ã—Ö –∞—É–¥–∏—Ç–æ–≤
- –î–µ–π—Å—Ç–≤—É–µ—Ç 1 –≥–æ–¥

**Pro** (50 –∫—Ä–µ–¥–∏—Ç–æ–≤) - –ü–æ–ø—É–ª—è—Ä–Ω—ã–π
- ~25 Research –∞—É–¥–∏—Ç–æ–≤
- ~50 –±—ã—Å—Ç—Ä—ã—Ö –∞—É–¥–∏—Ç–æ–≤
- –î–µ–π—Å—Ç–≤—É–µ—Ç 1 –≥–æ–¥
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –°–∫–∏–¥–∫–∞ 10%

**Team** (200 –∫—Ä–µ–¥–∏—Ç–æ–≤)
- ~100 Research –∞—É–¥–∏—Ç–æ–≤
- ~200 –±—ã—Å—Ç—Ä—ã—Ö –∞—É–¥–∏—Ç–æ–≤
- –î–µ–π—Å—Ç–≤—É–µ—Ç 1 –≥–æ–¥
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –°–∫–∏–¥–∫–∞ 25%

### –ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å

üéâ **5 –∫—Ä–µ–¥–∏—Ç–æ–≤** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## üìÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞–Ω—ã

| –ü–ª–∞–Ω | –ü–µ—Ä–∏–æ–¥ | USD | UAH | –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç | –≠–∫–æ–Ω–æ–º–∏—è |
|------|--------|-----|-----|---------------|----------|
| **Monthly Basic** | 1 –º–µ—Å—è—Ü | $9.99 | 400‚Ç¥ | 10 –∑–∞–ø—Ä–æ—Å–æ–≤ | - |
| **Monthly Pro** | 1 –º–µ—Å—è—Ü | $19.99 | 800‚Ç¥ | 25 –∑–∞–ø—Ä–æ—Å–æ–≤ | - |
| **Yearly Basic** | 1 –≥–æ–¥ | $99.99 | 4000‚Ç¥ | 10 –∑–∞–ø—Ä–æ—Å–æ–≤ | 17% |
| **Yearly Pro** | 1 –≥–æ–¥ | $199.99 | 8000‚Ç¥ | 25 –∑–∞–ø—Ä–æ—Å–æ–≤ | 17% |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥–ø–∏—Å–∫–∏

‚úÖ **–ë–µ–∑ –∫—Ä–µ–¥–∏—Ç–æ–≤** - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤
‚úÖ **–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç** - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
‚úÖ **–í—Å–µ —Ç–∏–ø—ã –∞—É–¥–∏—Ç–æ–≤** - –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ç–∏–ø—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - Email/Priority support –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞–Ω–∞

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É (monthly/yearly)
2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `subscriptions`
3. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ª–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ü–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ `end_date`
5. –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ù–ï —Ç—Ä–∞—Ç—è—Ç –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ –∞—É–¥–∏—Ç—ã

### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

```typescript
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
const hasSubscription = await has_active_subscription(userId)

if (hasSubscription) {
  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç
  const limitCheck = await check_daily_limit(userId)

  if (limitCheck.can_proceed) {
    // 3. –ü—Ä–æ–≤–æ–¥–∏–º –∞—É–¥–∏—Ç –ë–ï–ó —Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
    // 4. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    await increment_subscription_usage(userId, auditType)
  } else {
    // –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
  }
} else {
  // –û–±—ã—á–Ω—ã–π —Ñ–ª–æ—É —Å –∫—Ä–µ–¥–∏—Ç–∞–º–∏
}
```

---

## üí≥ –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

### Stripe (–¥–ª—è USD)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞**:
- Visa/Mastercard
- Apple Pay
- Google Pay

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:

```env
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

**–§–∞–π–ª—ã**:
- `src/lib/stripe.ts` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Stripe
- `src/app/api/stripe/create-payment-intent/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

### LiqPay (–¥–ª—è UAH)

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞**:
- Visa/Mastercard
- Apple Pay
- Google Pay
- –ü—Ä–∏–≤–∞—Ç24

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:

```env
LIQPAY_PUBLIC_KEY=sandbox_i00000000
LIQPAY_PRIVATE_KEY=sandbox_XXXXXXXXXXXXXXXXXXXXXXXX
```

**–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º**: –ó–∞–º–µ–Ω–∏—Ç–µ `sandbox_` –∫–ª—é—á–∏ –Ω–∞ –±–æ–µ–≤—ã–µ –¥–ª—è production

**–§–∞–π–ª—ã**:
- `src/lib/liqpay.ts` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ LiqPay
- `src/app/api/liqpay/create-payment/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `src/app/api/liqpay/webhook/route.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã**:
- **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: 4242 4242 4242 4242
- **–ù–µ—É—Å–ø–µ—à–Ω—ã–π**: 4100 0000 0000 0000

---

## ‚öôÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥: `src/config/tokenomics.config.ts`

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–µ–ª–∞—é—Ç—Å—è **–¢–û–õ–¨–ö–û** –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ!

#### –ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

1. **–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ–≤** (–æ–±—ä–µ–∫—Ç `AUDIT_COSTS`)
2. **–ü–∞–∫–µ—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤** (–æ–±—ä–µ–∫—Ç `CREDIT_PACKAGES`)
3. **–ü–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫** (–æ–±—ä–µ–∫—Ç `SUBSCRIPTION_PLANS`)
4. **–ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å** (–æ–±—ä–µ–∫—Ç `WELCOME_BONUS`)

#### –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –ø–∞–∫–µ—Ç–∞:

```typescript
export const CREDIT_PACKAGES: Record<PackageType, CreditPackage> = {
  pro: {
    id: 'pro',
    credits: 50,
    priceUSD: 8.99,  // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ USD —Ü–µ–Ω—É
    priceUAH: 360,   // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ UAH —Ü–µ–Ω—É
    // ...
  }
}
```

#### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã —Ç–æ–∫–µ–Ω–æ–º–∏–∫–∏

#### 1. `audit_credits` - –°—Ç–æ–∏–º–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ–≤

```sql
CREATE TABLE audit_credits (
    id UUID PRIMARY KEY,
    audit_type TEXT,
    credits_cost INTEGER,
    is_active BOOLEAN
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∞—É–¥–∏—Ç–∞

#### 2. `user_balances` - –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
CREATE TABLE user_balances (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id),
    balance INTEGER,
    grace_limit_used BOOLEAN,
    updated_at TIMESTAMP
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 3. `transactions` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```sql
CREATE TABLE transactions (
    id UUID PRIMARY KEY,
    user_id UUID,
    type TEXT, -- 'credit' –∏–ª–∏ 'debit'
    amount INTEGER,
    balance_after INTEGER,
    source TEXT,
    description TEXT,
    related_audit_id UUID,
    created_at TIMESTAMP
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫—Ä–µ–¥–∏—Ç–∞–º–∏

#### 4. `subscriptions` - –ü–æ–¥–ø–∏—Å–∫–∏

```sql
CREATE TABLE subscriptions (
    id UUID PRIMARY KEY,
    user_id UUID UNIQUE,
    subscription_type TEXT,
    status TEXT, -- 'active', 'cancelled', 'expired'
    payment_provider TEXT, -- 'stripe', 'liqpay'
    start_date TIMESTAMP,
    end_date TIMESTAMP,
    daily_limit INTEGER,
    external_subscription_id TEXT
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 5. `subscription_usage` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

```sql
CREATE TABLE subscription_usage (
    id UUID PRIMARY KEY,
    subscription_id UUID,
    user_id UUID,
    usage_date DATE,
    requests_count INTEGER,
    audit_types JSONB
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 6. `payment_orders` - –ó–∞–∫–∞–∑—ã

```sql
CREATE TABLE payment_orders (
    id UUID PRIMARY KEY,
    user_id UUID,
    order_type TEXT, -- 'credits', 'subscription'
    package_id TEXT,
    subscription_type TEXT,
    amount_usd DECIMAL,
    amount_uah DECIMAL,
    payment_provider TEXT,
    status TEXT, -- 'pending', 'completed', 'failed'
    stripe_payment_intent_id TEXT,
    liqpay_payment_id TEXT
);
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è**: –í—Å–µ –∑–∞–∫–∞–∑—ã (–∫—Ä–µ–¥–∏—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏)

### RPC –§—É–Ω–∫—Ü–∏–∏

#### –î–ª—è –∫—Ä–µ–¥–∏—Ç–æ–≤:

- `get_user_balance(user_id)` - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
- `can_deduct_credits(user_id, amount)` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è
- `deduct_credits(user_id, amount, source, description, audit_id)` - –°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã
- `add_credits(user_id, amount, source, description)` - –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã

#### –î–ª—è –ø–æ–¥–ø–∏—Å–æ–∫:

- `has_active_subscription(user_id)` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
- `check_daily_limit(user_id)` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç
- `increment_subscription_usage(user_id, audit_type)` - –£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫

---

## üîå API Endpoints

### –ö—Ä–µ–¥–∏—Ç—ã

#### GET `/api/credits/balance`
–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response**:
```json
{
  "balance": 10,
  "grace_limit_used": false,
  "last_updated": "2025-12-01T12:00:00Z"
}
```

#### GET `/api/credits/packages`
–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

#### POST `/api/stripe/create-payment-intent`
–°–æ–∑–¥–∞—Ç—å Stripe –ø–ª–∞—Ç–µ–∂ –¥–ª—è –∫—Ä–µ–¥–∏—Ç–æ–≤

#### POST `/api/liqpay/create-payment`
–°–æ–∑–¥–∞—Ç—å LiqPay –ø–ª–∞—Ç–µ–∂ –¥–ª—è –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**Request**:
```json
{
  "userId": "uuid",
  "type": "credits", // –∏–ª–∏ "subscription"
  "packageId": "pro" // –∏–ª–∏ subscriptionId
}
```

**Response**:
```json
{
  "success": true,
  "orderId": "uuid",
  "data": "base64...",
  "signature": "base64...",
  "checkoutUrl": "https://www.liqpay.ua/..."
}
```

### –ü–æ–¥–ø–∏—Å–∫–∏

#### GET `/api/subscription/status`
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ (TODO)

#### POST `/api/subscription/cancel`
–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É (TODO)

### Webhooks

#### POST `/api/stripe/webhook`
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç Stripe

#### POST `/api/liqpay/webhook`
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç LiqPay

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LiqPay (–ø–µ—Å–æ—á–Ω–∏—Ü–∞)

1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏**: https://www.liqpay.ua/
2. **–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`**:
```env
LIQPAY_PUBLIC_KEY=sandbox_i00000000
LIQPAY_PRIVATE_KEY=sandbox_XXXXXXXXXXXXXXXXXXXXXXXX
```

3. **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã**:
   - –£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂: `4242424242424242`
   - –ù–µ—É—Å–ø–µ—à–Ω—ã–π: `4100000000000000`
   - CVV: –ª—é–±–æ–π 3-–∑–Ω–∞—á–Ω—ã–π
   - –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ webhook**:
```bash
curl -X GET http://localhost:3000/api/liqpay/webhook
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Stripe

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏** (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `pk_test_`, `sk_test_`)
2. **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã**: https://stripe.com/docs/testing
3. **Webhook testing**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Stripe CLI

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞—É–¥–∏—Ç–æ–≤
SELECT * FROM audit_credits;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT * FROM user_balances WHERE user_id = 'YOUR_USER_ID';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
SELECT * FROM transactions WHERE user_id = 'YOUR_USER_ID' ORDER BY created_at DESC LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏
SELECT * FROM subscriptions WHERE user_id = 'YOUR_USER_ID';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT * FROM subscription_usage WHERE user_id = 'YOUR_USER_ID' AND usage_date = CURRENT_DATE;
```

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

1. `create_credits_tables.sql` - –ë–∞–∑–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∫—Ä–µ–¥–∏—Ç–æ–≤ (–£–ñ–ï –ü–†–ò–ú–ï–ù–ï–ù–û)
2. `create_credits_rpc_functions.sql` - RPC —Ñ—É–Ω–∫—Ü–∏–∏ (–£–ñ–ï –ü–†–ò–ú–ï–ù–ï–ù–û)
3. `update_tokenomics_v2.sql` - ‚ú® **–ù–æ–≤–∞—è** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞—É–¥–∏—Ç–æ–≤
4. `create_subscriptions_table.sql` - ‚ú® **–ù–æ–≤–∞—è** - –¢–∞–±–ª–∏—Ü—ã –ø–æ–¥–ø–∏—Å–æ–∫
5. `create_payment_orders_table.sql` - ‚ú® **–ù–æ–≤–∞—è** - –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤

### –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# –ß–µ—Ä–µ–∑ Supabase CLI
supabase db push

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL Editor –≤ Supabase Dashboard
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ß—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `CreditsPurchase` –¥–ª—è –≤—ã–±–æ—Ä–∞ Stripe/LiqPay
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/subscription` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ API
- [ ] –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –ª–∏–º–∏—Ç–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ API —Ä–æ—É—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å LiqPay –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–æ–∫–µ–Ω–æ–º–∏–∫–µ:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
2. –ò–∑—É—á–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥: `src/config/tokenomics.config.ts`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 01.12.2025
**–ê–≤—Ç–æ—Ä**: UX Audit Platform Team
**–í–µ—Ä—Å–∏—è**: 2.0
